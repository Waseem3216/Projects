<%- include('partials/header') %>

<% if (!recipe) { %>
  <section class="card"><p class="muted">Recipe not found.</p></section>
<% } else { %>

<section class="card">
  <h2>Recipe</h2>
  <form action="/recipes/<%= recipe.id %>/update" method="post" class="form-grid">
    <label>Instructions
      <textarea name="instructions" rows="4" required><%= recipe.instructions %></textarea>
    </label>
    <button type="submit">Save Instructions</button>
  </form>
</section>

<section class="card">
  <h3>Cook Status</h3>
  <% if (status && status.can_cook) { %>
    <p class="flash flash-ok">All set. Inventory is sufficient.</p>
    <form action="/recipes/<%= recipe.id %>/cook" method="post">
      <button type="submit">Cook</button>
    </form>
  <% } else if (status) { %>
    <p class="flash flash-err">Cannot cook. Missing or insufficient ingredients:</p>
    <ul class="list">
      <% (status.shortages || []).forEach(s => { %>
        <li><strong><%= s.ingredientname %></strong> — have <%= s.have %>, need <%= s.need %></li>
      <% }) %>
    </ul>
  <% } %>
</section>

<section class="card">
  <h3>Ingredients for this recipe</h3>
  <table class="table">
    <thead><tr><th>Ingredient</th><th>Amount</th></tr></thead>
    <tbody>
      <% if ((recipe.items || []).length === 0) { %>
        <tr><td colspan="2" class="muted">No ingredients yet.</td></tr>
      <% } %>
      <% (recipe.items || []).forEach(line => { %>
        <tr><td><%= line.ingredientname %></td><td><%= line.amount %></td></tr>
      <% }) %>
    </tbody>
  </table>
</section>

<section class="card">
  <h3>Add Ingredient to Recipe</h3>
  <form action="/recipes/<%= recipe.id %>/items/add" method="post" class="form-grid">
    <label>Ingredient
      <select name="ingredientid" required>
        <option value="" disabled selected>Pick one</option>
        <% ingredients.forEach(i => { %>
          <option value="<%= i.id %>"><%= (i.sku ? i.sku + " — " : "") + i.ingredientname %></option>
        <% }) %>
      </select>
    </label>
    <label>Amount
      <input name="amount" type="number" step="0.01" min="0.01" placeholder="e.g., 100" required />
    </label>
    <button type="submit">Add</button>
  </form>
</section>

<% } %>

<%- include('partials/footer') %>
